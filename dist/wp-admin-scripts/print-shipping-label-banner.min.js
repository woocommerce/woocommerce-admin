this.wc=this.wc||{},this.wc.printShippingLabelBanner=function(e){var t={};function n(s){if(t[s])return t[s].exports;var i=t[s]={i:s,l:!1,exports:{}};return e[s].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(s,i,function(t){return e[t]}.bind(null,i));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=489)}({0:function(e,t){e.exports=window.wp.element},1:function(e,t,n){e.exports=n(60)()},105:function(e,t,n){"use strict";var s=n(0);t.a=function(e){let{icon:t,size:n=24,...i}=e;return Object(s.cloneElement)(t,{width:n,height:n,...i})}},12:function(e,t){e.exports=window.wc.data},14:function(e,t){e.exports=window.wp.compose},15:function(e,t){e.exports=window.wc.wcSettings},17:function(e,t){e.exports=window.wc.tracks},19:function(e,t){e.exports=window.wp.apiFetch},2:function(e,t){e.exports=window.wp.i18n},20:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var s=n(6);function i(e){return e.startsWith("{{/")?{type:"componentClose",value:e.replace(/\W/g,"")}:e.endsWith("/}}")?{type:"componentSelfClosing",value:e.replace(/\W/g,"")}:e.startsWith("{{")?{type:"componentOpen",value:e.replace(/\W/g,"")}:{type:"string",value:e}}function o(e,t){let n,i,r=[];for(let s=0;s<e.length;s++){const o=e[s];if("string"!==o.type){if(void 0===t[o.value])throw new Error(`Invalid interpolation, missing component node: \`${o.value}\``);if("object"!=typeof t[o.value])throw new Error(`Invalid interpolation, component node must be a ReactElement or null: \`${o.value}\``);if("componentClose"===o.type)throw new Error(`Missing opening component token: \`${o.value}\``);if("componentOpen"===o.type){n=t[o.value],i=s;break}r.push(t[o.value])}else r.push(o.value)}if(n){const c=function(e,t){const n=t[e];let s=0;for(let i=e+1;i<t.length;i++){const e=t[i];if(e.value===n.value){if("componentOpen"===e.type){s++;continue}if("componentClose"===e.type){if(0===s)return i;s--}}}throw new Error("Missing closing component token `"+n.value+"`")}(i,e),a=o(e.slice(i+1,c),t),l=Object(s.cloneElement)(n,{},a);if(r.push(l),c<e.length-1){const n=o(e.slice(c+1),t);r=r.concat(n)}}return r=r.filter(Boolean),0===r.length?null:1===r.length?r[0]:Object(s.createElement)(s.Fragment,null,...r)}function r(e){const{mixedString:t,components:n,throwErrors:s}=e;if(!n)return t;if("object"!=typeof n){if(s)throw new Error(`Interpolation Error: unable to process \`${t}\` because components is not an object`);return t}const r=function(e){return e.split(/(\{\{\/?\s*\w+\s*\/?\}\})/g).map(i)}(t);try{return o(r,n)}catch(e){if(s)throw new Error(`Interpolation Error: unable to process \`${t}\` because of error \`${e.message}\``);return t}}},23:function(e,t,n){"use strict";n.d(t,"d",(function(){return a})),n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return d})),n.d(t,"c",(function(){return p})),n.d(t,"e",(function(){return m}));var s=n(2),i=n(15);const o=["wcAdminSettings","preloadSettings"],r=Object(i.getSetting)("admin",{}),c=Object.keys(r).reduce((e,t)=>(o.includes(t)||(e[t]=r[t]),e),{});function a(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e=>e;if(o.includes(e))throw new Error(Object(s.__)("Mutable settings should be accessed via data store."));const i=c.hasOwnProperty(e)?c[e]:t;return n(i,t)}Object(i.getSetting)("adminUrl"),Object(i.getSetting)("countries");const l=Object(i.getSetting)("currency"),d=Object(i.getSetting)("locale"),p=(Object(i.getSetting)("siteTitle"),Object(i.getSetting)("wcAssetUrl"),a("orderStatuses"));function m(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e=>e;if(o.includes(e))throw new Error(Object(s.__)("Mutable settings should be mutated via data store."));c[e]=n(t)}},255:function(e,t,n){},4:function(e,t){e.exports=window.wp.components},43:function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},e.exports.__esModule=!0,e.exports.default=e.exports},489:function(e,t,n){"use strict";n.r(t);var s=n(0),i=n(12),o=n(43),r=n.n(o),c=n(2),a=n(4),l=n(14),d=n(20),p=n(1),m=n.n(p),u=n(5),h=n(8),w=n(17);n(255);class b extends s.Component{constructor(){super(...arguments),r()(this,"setDismissed",e=>{this.props.updateOptions({woocommerce_shipping_dismissed_timestamp:e})}),r()(this,"hideBanner",()=>{document.getElementById("woocommerce-admin-print-label").style.display="none"}),r()(this,"remindMeLaterClicked",()=>{const{onCloseAll:e,trackElementClicked:t}=this.props;this.setDismissed(Date.now()),e(),this.hideBanner(),t("shipping_banner_dismiss_modal_remind_me_later")}),r()(this,"closeForeverClicked",()=>{const{onCloseAll:e,trackElementClicked:t}=this.props;this.setDismissed(-1),e(),this.hideBanner(),t("shipping_banner_dismiss_modal_close_forever")})}render(){const{onClose:e,visible:t}=this.props;return t?Object(s.createElement)(a.Modal,{title:Object(c.__)("Are you sure?","woocommerce-admin"),onRequestClose:e,className:"wc-admin-shipping-banner__dismiss-modal"},Object(s.createElement)("p",{className:"wc-admin-shipping-banner__dismiss-modal-help-text"},Object(c.__)("With WooCommerce Shipping you can Print shipping labels from your WooCommerce dashboard at the lowest USPS rates.","woocommerce-admin")),Object(s.createElement)("div",{className:"wc-admin-shipping-banner__dismiss-modal-actions"},Object(s.createElement)(a.Button,{isSecondary:!0,onClick:this.remindMeLaterClicked},Object(c.__)("Remind me later","woocommerce-admin")),Object(s.createElement)(a.Button,{isPrimary:!0,onClick:this.closeForeverClicked},Object(c.__)("I don't need this","woocommerce-admin")))):null}}var g=Object(l.compose)(Object(h.withDispatch)(e=>{const{updateOptions:t}=e(i.OPTIONS_STORE_NAME);return{updateOptions:t}}))(b),f=n(105),_=n(9);var O=Object(s.createElement)(_.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"-2 -2 24 24"},Object(s.createElement)(_.Path,{d:"M10 2c4.42 0 8 3.58 8 8s-3.58 8-8 8-8-3.58-8-8 3.58-8 8-8zm1.13 9.38l.35-6.46H8.52l.35 6.46h2.26zm-.09 3.36c.24-.23.37-.55.37-.96 0-.42-.12-.74-.36-.97s-.59-.35-1.06-.35-.82.12-1.07.35-.37.55-.37.97c0 .41.13.73.38.96.26.23.61.34 1.06.34s.8-.11 1.05-.34z"}));const v="install",j="activate",y="setup",S="start",E={["download"]:Object(c.__)("download","woocommerce-admin"),[v]:Object(c.__)("install","woocommerce-admin"),[j]:Object(c.__)("activate","woocommerce-admin"),[y]:Object(c.__)("set up","woocommerce-admin"),[S]:Object(c.__)("start","woocommerce-admin")};function k(e){let{isSetupError:t,errorReason:n}=e;return t?Object(s.createElement)("div",{className:"wc-admin-shipping-banner-install-error"},Object(s.createElement)(f.a,{icon:O,className:"warning-icon"}),(e=>{const t=e in E?E[e]:E[y];return Object(c.sprintf)(Object(c.__)("Unable to %s the plugin. Refresh the page and try again.","woocommerce-admin"),t)})(n)):null}var C=n(19),x=n.n(C);var P=n(23);const B=Object(P.d)("wcAdminAssetUrl",""),L="woocommerce-services";class A extends s.Component{constructor(e){var t;super(e),t=this,r()(this,"isSetupError",()=>this.state.wcsSetupError),r()(this,"closeDismissModal",()=>{this.setState({isDismissModalOpen:!1}),this.trackElementClicked("shipping_banner_dismiss_modal_close_button")}),r()(this,"openDismissModal",()=>{this.setState({isDismissModalOpen:!0}),this.trackElementClicked("shipping_banner_dimiss")}),r()(this,"hideBanner",()=>{this.setState({showShippingBanner:!1})}),r()(this,"createShippingLabelClicked",()=>{const{activePlugins:e}=this.props;this.setState({isShippingLabelButtonBusy:!0}),this.trackElementClicked("shipping_banner_create_label"),e.includes(L)?this.acceptTosAndGetWCSAssets():this.installAndActivatePlugins(L)}),r()(this,"woocommerceServiceLinkClicked",()=>{this.trackElementClicked("shipping_banner_woocommerce_service_link")}),r()(this,"trackBannerEvent",(function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{activePlugins:s,isJetpackConnected:i}=t.props;Object(w.recordEvent)(e,{banner_name:"wcadmin_install_wcs_prompt",jetpack_installed:s.includes("jetpack"),jetpack_connected:i,wcs_installed:s.includes(L),...n})})),r()(this,"trackImpression",()=>{this.trackBannerEvent("banner_impression")}),r()(this,"trackElementClicked",e=>{this.trackBannerEvent("banner_element_clicked",{element:e})}),r()(this,"getInstallText",()=>{const{activePlugins:e}=this.props;return e.includes(L)?Object(c.__)('You\'ve already installed WooCommerce Shipping. By clicking "Create shipping label", you agree to its {{tosLink}}Terms of Service{{/tosLink}}.',"woocommerce-admin"):Object(c.__)('By clicking "Create shipping label", {{wcsLink}}WooCommerce Shipping{{/wcsLink}} will be installed and you agree to its {{tosLink}}Terms of Service{{/tosLink}}.',"woocommerce-admin")});const n=new URL(window.location.href).searchParams.get("post");this.state={showShippingBanner:!0,isDismissModalOpen:!1,setupErrorReason:y,orderId:parseInt(n,10),wcsAssetsLoaded:!1,wcsAssetsLoading:!1,wcsSetupError:!1,isShippingLabelButtonBusy:!1,installText:this.getInstallText(),isWcsModalOpen:!1}}componentDidMount(){const{showShippingBanner:e}=this.state;e&&this.trackImpression()}async installAndActivatePlugins(e){const{installPlugins:t,activatePlugins:n,isRequesting:s}=this.props;if(s)return!1;if(!0!==(await t([e])).success)return void this.setState({setupErrorReason:v,wcsSetupError:!0});!0===(await n([e])).success?this.acceptTosAndGetWCSAssets():this.setState({setupErrorReason:j,wcsSetupError:!0})}acceptTosAndGetWCSAssets(){return x()({path:"/wc/v1/connect/tos",method:"POST",data:{accepted:!0}}).then(()=>x()({path:"/wc/v1/connect/assets",method:"GET"})).then(e=>this.loadWcsAssets(e)).catch(()=>this.setState({wcsSetupError:!0}))}generateMetaBoxHtml(e,t,n){const s=JSON.stringify(n).replace(/"/g,"&quot;");return`\n<div id="${e}" class="postbox">\n\t<div class="postbox-header">\n\t\t<h2 class="hndle"><span>${t}</span></h2>\n\t\t<div class="handle-actions">\n\t\t\t<button type="button" class="handlediv" aria-expanded="true">\n\t\t\t\t<span class="screen-reader-text">${Object(c.__)("Toggle panel:","woocommerce-admin")} ${t}</span>\n\t\t\t\t<span class="toggle-indicator" aria-hidden="true"></span>\n\t\t\t</button>\n\t\t</div>\n\t</div>\n\t<div class="inside">\n\t\t<div class="wcc-root woocommerce wc-connect-create-shipping-label" data-args="${s}">\n\t\t</div>\n\t</div>\n</div>\n`}loadWcsAssets(e){let{assets:t}=e;if(this.state.wcsAssetsLoaded||this.state.wcsAssetsLoading)return void this.openWcsModal();this.setState({wcsAssetsLoading:!0});const n=t.wc_connect_admin_script,s=t.wc_connect_admin_style;if(void 0===window.wcsPluginData){const e=n.substring(0,n.lastIndexOf("/")+1);window.wcsPluginData={assetPath:e}}const{orderId:i}=this.state,{itemsCount:o}=this.props,r=this.generateMetaBoxHtml("woocommerce-order-label",Object(c.__)("Shipping Label","woocommerce-admin"),{order:{id:i},context:"shipping_label",items:o});document.getElementById("woocommerce-order-data").insertAdjacentHTML("beforebegin",r);const a=this.generateMetaBoxHtml("woocommerce-order-shipment-tracking",Object(c.__)("Shipment Tracking","woocommerce-admin"),{order:{id:i},context:"shipment_tracking",items:o});document.getElementById("woocommerce-order-actions").insertAdjacentHTML("afterend",a),window.jQuery&&(window.jQuery("#normal-sortables").sortable("refresh"),window.jQuery("#side-sortables").sortable("refresh"),window.jQuery("#woocommerce-order-label").hide()),Promise.all([new Promise((e,t)=>{const s=document.createElement("script");s.src=n,s.async=!0,s.onload=e,s.onerror=t,document.body.appendChild(s)}),new Promise((e,t)=>{if(""!==s){const n=document.getElementsByTagName("head")[0],i=document.createElement("link");i.rel="stylesheet",i.type="text/css",i.href=s,i.media="all",i.onload=e,i.onerror=t,n.appendChild(i)}else e()})]).then(()=>{this.setState({wcsAssetsLoaded:!0,wcsAssetsLoading:!1,isShippingLabelButtonBusy:!1}),this.openWcsModal()})}openWcsModal(){window.wcsGetAppStoreAsync&&window.wcsGetAppStoreAsync("wc-connect-create-shipping-label").then(e=>{const t=e.getState(),{orderId:n}=this.state,s=t.ui.selectedSiteId,i=e.subscribe(()=>{const t=e.getState(),o=Object(u.get)(t,["extensions","woocommerce","woocommerceServices",s,"shippingLabel",n],null),r=Object(u.get)(t,["extensions","woocommerce","woocommerceServices",s,"labelSettings"],null),a=Object(u.get)(t,["extensions","woocommerce","woocommerceServices",s,"packages"],null),l=Object(u.get)(t,["extensions","woocommerce","sites",s,"data","locations"]);o&&r&&r.meta&&a&&l&&(o.loaded&&r.meta.isLoaded&&a.isLoaded&&Object(u.isArray)(l)&&!this.state.isWcsModalOpen?(window.jQuery&&(this.setState({isWcsModalOpen:!0}),window.jQuery(".shipping-label__new-label-button").click()),e.dispatch({type:"NOTICE_CREATE",notice:{duration:1e4,status:"is-success",text:Object(c.__)("Plugin installed and activated","woocommerce-admin")}})):o.showPurchaseDialog&&(i(),window.jQuery&&window.jQuery("#woocommerce-order-label").show()))});document.getElementById("woocommerce-admin-print-label").style.display="none"})}render(){const{isDismissModalOpen:e,showShippingBanner:t,isShippingLabelButtonBusy:n}=this.state;return t?Object(s.createElement)("div",null,Object(s.createElement)("div",{className:"wc-admin-shipping-banner-container"},Object(s.createElement)("img",{className:"wc-admin-shipping-banner-illustration",src:B+"shippingillustration.svg",alt:Object(c.__)("Shipping ","woocommerce-admin")}),Object(s.createElement)("div",{className:"wc-admin-shipping-banner-blob"},Object(s.createElement)("h3",null,Object(c.__)("Print discounted shipping labels with a click.","woocommerce-admin")),Object(s.createElement)("p",null,Object(d.a)({mixedString:this.state.installText,components:{tosLink:Object(s.createElement)(a.ExternalLink,{href:"https://wordpress.com/tos",target:"_blank",type:"external"}),wcsLink:Object(s.createElement)(a.ExternalLink,{href:"https://woocommerce.com/products/shipping/?utm_medium=product",target:"_blank",type:"external",onClick:this.woocommerceServiceLinkClicked})}})),Object(s.createElement)(k,{isSetupError:this.isSetupError(),errorReason:this.state.setupErrorReason})),Object(s.createElement)(a.Button,{disabled:n,isPrimary:!0,isBusy:n,onClick:this.createShippingLabelClicked},Object(c.__)("Create shipping label","woocommerce-admin")),Object(s.createElement)("button",{onClick:this.openDismissModal,type:"button",className:"notice-dismiss",disabled:this.state.isShippingLabelButtonBusy},Object(s.createElement)("span",{className:"screen-reader-text"},Object(c.__)("Close Print Label Banner.","woocommerce-admin")))),Object(s.createElement)(g,{visible:e,onClose:this.closeDismissModal,onCloseAll:this.hideBanner,trackElementClicked:this.trackElementClicked})):null}}A.propTypes={itemsCount:m.a.number.isRequired,isJetpackConnected:m.a.bool.isRequired,activePlugins:m.a.array.isRequired,activatePlugins:m.a.func.isRequired,installPlugins:m.a.func.isRequired,isRequesting:m.a.bool.isRequired};var M=Object(l.compose)(Object(h.withSelect)(e=>{const{isPluginsRequesting:t,isJetpackConnected:n,getActivePlugins:s}=e(i.PLUGINS_STORE_NAME);return{isRequesting:t("activatePlugins")||t("installPlugins"),isJetpackConnected:n(),activePlugins:s()}}),Object(h.withDispatch)(e=>{const{activatePlugins:t,installPlugins:n}=e(i.PLUGINS_STORE_NAME);return{activatePlugins:t,installPlugins:n}}))(A);const T=document.getElementById("wc-admin-shipping-banner-root"),R=T.dataset.args&&JSON.parse(T.dataset.args)||{},I=Object(i.withPluginsHydration)({...Object(P.d)("plugins"),jetpackStatus:Object(P.d)("dataEndpoints",{}).jetpackStatus})(M);Object(s.render)(Object(s.createElement)(I,{itemsCount:R.items}),T)},5:function(e,t){e.exports=window.lodash},6:function(e,t){e.exports=window.React},60:function(e,t,n){"use strict";var s=n(61);function i(){}function o(){}o.resetWarningCache=i,e.exports=function(){function e(e,t,n,i,o,r){if(r!==s){var c=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw c.name="Invariant Violation",c}}function t(){return e}e.isRequired=e;var n={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:o,resetWarningCache:i};return n.PropTypes=n,n}},61:function(e,t,n){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},8:function(e,t){e.exports=window.wp.data},9:function(e,t){e.exports=window.wp.primitives}});